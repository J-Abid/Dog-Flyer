<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adopt Shonik - Perfect A4 Flyer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --c-yellow: #FFD93D;
            --c-red: #FF6B6B;
            --c-blue: #4D96FF;
            --c-black: #222;
        }

        * { box-sizing: border-box; }

        body {
            background-color: #555;
            font-family: 'Comic Neue', cursive;
            display: flex;
            justify-content: center;
            padding: 20px;
            margin: 0;
        }

        /* --- STRICT A4 CONTAINER --- */
        #flyer {
            width: 210mm;
            height: 296mm; /* 1mm safety buffer for PDF engines */
            background-color: white;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column; /* Vertical Flex Layout */
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            
            /* Pop Art Pattern */
            background-image: 
                radial-gradient(var(--c-blue) 15%, transparent 16%), 
                radial-gradient(#f0f0f0 15%, transparent 16%);
            background-color: #fff;
            background-position: 0 0, 10px 10px;
            background-size: 20px 20px;
        }

        /* --- TYPOGRAPHY --- */
        h1 {
            font-family: 'Bangers', cursive;
            line-height: 0.9;
            text-shadow: 3px 3px 0px var(--c-black);
            -webkit-text-stroke: 1px var(--c-black);
        }
        .comic-font { font-family: 'Bangers', cursive; letter-spacing: 1px; }

        /* --- INTERACTIVE FRAMES --- */
        .frame-container {
            position: relative;
            background: #eee;
            border: 3px solid var(--c-black);
            box-shadow: 5px 5px 0px var(--c-black);
            overflow: hidden;
            cursor: grab;
            width: 100%;
        }
        .frame-container:active { cursor: grabbing; }
        
        .frame-container img {
            position: absolute; top: 0; left: 0;
            transform-origin: center center;
            max-width: none;
        }

        .upload-msg {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: rgba(255,255,255,0.9);
            z-index: 20; pointer-events: none;
            transition: opacity 0.3s;
            text-align: center;
        }

        /* Zoom Controls */
        .zoom-bar {
            height: 20px; background: var(--c-black);
            display: flex; align-items: center; justify-content: center;
            padding: 0 10px; width: 100%;
        }
        .zoom-bar input { flex-grow: 1; cursor: pointer; height: 4px; }
        .zoom-bar i { color: white; font-size: 10px; margin: 0 5px; }

        /* --- LAYOUT SECTIONS (FLEX) --- */
        
        /* 1. HEADER (Fixed Height) */
        .header {
            flex: 0 0 auto; /* Don't grow/shrink */
            background: var(--c-red); color: white;
            padding: 12px 30px;
            border-bottom: 4px solid var(--c-black);
            display: flex; justify-content: space-between; align-items: center;
            z-index: 10;
        }

        /* 2. HERO (Fixed Height) */
        .hero-wrap {
            flex: 0 0 auto;
            display: flex; padding: 15px 30px 5px 30px; gap: 20px;
            align-items: flex-start; z-index: 5;
        }

        /* Speech Bubble */
        .bubble {
            background: white;
            border: 3px solid var(--c-black);
            padding: 15px; border-radius: 15px;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.1);
            position: relative;
        }
        .bubble::after {
            content: ''; position: absolute; left: -20px; top: 30px;
            border: 10px solid transparent; border-right-color: var(--c-black);
        }

        /* Tags */
        .tag {
            background: var(--c-yellow);
            border: 2px solid var(--c-black);
            padding: 3px 8px; font-weight: 700; font-size: 0.8rem;
            box-shadow: 2px 2px 0px rgba(0,0,0,0.2);
            display: inline-flex; align-items: center; gap: 4px;
            transform: rotate(-1deg);
        }
        .tag.red { background: var(--c-red); color: white; transform: rotate(1deg); }
        .tag.white { background: white; transform: rotate(2deg); }

        /* 3. GALLERY (Flexible - Fills remaining space) */
        .gallery-wrap {
            flex: 1 1 auto; /* Grow to fill space */
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center; /* Center vertically */
            padding: 0 30px;
            gap: 15px;
            z-index: 5;
            min-height: 0; /* Allow shrinking if needed */
        }
        
        .polaroid {
            flex: 1; /* Equal width */
            background: white; padding: 5px 5px 25px 5px;
            border: 2px solid var(--c-black);
            box-shadow: 5px 5px 0px rgba(0,0,0,0.15);
            display: flex; flex-direction: column;
            height: 100%;
            max-height: 260px; /* Cap max height */
        }

        .frame-label {
            text-align: center; font-family: 'Bangers', cursive; font-size: 1.2rem;
            margin-top: 5px; color: var(--c-black);
        }

        /* 4. FOOTER (Fixed Height) */
        .footer {
            flex: 0 0 auto;
            background: var(--c-black); color: white;
            padding: 15px 30px;
            display: flex; justify-content: space-between; align-items: center;
            border-top: 5px solid var(--c-yellow);
            z-index: 10;
        }

        /* --- PDF BUTTON --- */
        .btn-save {
            position: fixed; top: 20px; right: 20px; z-index: 9999;
            background: var(--c-red); color: white;
            border: 4px solid white; padding: 12px 30px;
            font-weight: 900; font-size: 1.2rem; border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); cursor: pointer;
            transition: transform 0.2s;
        }
        .btn-save:hover { transform: scale(1.05); background: #ff4444; }

        @media print {
            .zoom-bar, .upload-msg, .btn-save { display: none !important; }
            body { background: none; padding: 0; margin: 0; }
            #flyer { margin: 0; box-shadow: none; height: 100%; width: 100%; }
        }
    </style>
</head>
<body>

    <button onclick="downloadPDF()" class="btn-save">
        <i class="fas fa-download"></i> DOWNLOAD PDF
    </button>

    <div id="flyer">
        
        <!-- HEADER -->
        <div class="header">
            <div class="comic-font text-2xl tracking-widest text-yellow-300">
                <i class="fas fa-bullhorn"></i> URGENT ADOPTION
            </div>
            <div class="bg-white text-black px-3 py-1 border-2 border-black font-bold transform rotate-2 shadow-lg text-sm">
                MELITO, ITALY
            </div>
        </div>

        <!-- HERO SECTION -->
        <div class="hero-wrap">
            <!-- Main Photo (Rotated Left) -->
            <div class="flex-shrink-0 transform rotate-1 w-[240px]">
                <input type="file" id="file1" class="hidden" accept="image/*" onchange="handleFileSelect(this, 'frame1', 'img1')">
                <div class="frame-container h-[240px]" id="frame1" onmousedown="startDrag(event, 'img1')" onclick="document.getElementById('file1').click()">
                    <img id="img1" style="width: 100%;">
                    <div class="upload-msg">
                        <i class="fas fa-camera text-4xl mb-1 text-gray-400"></i>
                        <span class="font-bold bg-white px-1 text-xs">CLICK TO UPLOAD</span>
                    </div>
                </div>
                <div class="zoom-bar">
                    <i class="fas fa-minus"></i>
                    <input type="range" min="0.5" max="3" step="0.1" value="1" oninput="updateZoom('img1', this.value)">
                    <i class="fas fa-plus"></i>
                </div>
                <div class="bg-black text-yellow-400 text-center font-bangers text-xl py-1 mt-1">
                    PROFILE
                </div>
            </div>

            <!-- Description -->
            <div class="flex-grow pl-4 pt-1">
                <h1 class="text-7xl text-yellow-400 mb-1 relative z-10 tracking-wide">SHONIK</h1>
                <h2 class="comic-font text-xl text-white bg-black inline-block px-2 transform -skew-x-12 mb-3 border-2 border-white shadow-md">
                    THE "BUNDLE OF JOY"
                </h2>
                
                <div class="bubble">
                    <h3 class="font-bold text-lg mb-2 text-blue-600">HI! I'M SHONIK! üêæ</h3>
                    <p class="text-gray-800 font-bold leading-snug text-sm">
                        I am a pure burst of energy! I've been with my family since I was a puppy (Born Nov 2016), but my mom is <span class="text-red-600 bg-yellow-100 px-1">moving to London</span> and can't take me.
                        <br><br>
                        I am <strong>super active</strong>, playful, and I take my job as a "House Alarm" seriously! I need an owner who loves the outdoors.
                    </p>

                    <!-- Tags Grid -->
                    <div class="flex flex-wrap gap-2 mt-3">
                        <div class="tag"><i class="fas fa-dog"></i> Beagle Mix</div>
                        <div class="tag red"><i class="fas fa-bolt"></i> High Energy</div>
                        <div class="tag white"><i class="fas fa-shield-alt"></i> Watchdog</div>
                        <div class="tag"><i class="fas fa-microchip"></i> Microchipped</div>
                        <div class="tag red"><i class="fas fa-book-medical"></i> Health Booklet</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GALLERY SECTION (Flexible) -->
        <div class="gallery-wrap">
            
            <!-- CUTE -->
            <div class="polaroid transform -rotate-1">
                <input type="file" id="file2" class="hidden" accept="image/*" onchange="handleFileSelect(this, 'frame2', 'img2')">
                <div class="frame-container flex-grow" style="height: 100%;" id="frame2" onmousedown="startDrag(event, 'img2')" onclick="document.getElementById('file2').click()">
                    <img id="img2" style="width: 150%;">
                    <div class="upload-msg"><i class="fas fa-image text-3xl text-gray-300"></i></div>
                </div>
                <div class="zoom-bar"><input type="range" min="0.5" max="3" step="0.1" value="1" oninput="updateZoom('img2', this.value)"></div>
                <div class="frame-label text-pink-500">CUTE</div>
            </div>

            <!-- STRETCHING -->
            <div class="polaroid transform rotate-1 mt-4">
                <input type="file" id="file3" class="hidden" accept="image/*" onchange="handleFileSelect(this, 'frame3', 'img3')">
                <div class="frame-container flex-grow" style="height: 100%;" id="frame3" onmousedown="startDrag(event, 'img3')" onclick="document.getElementById('file3').click()">
                    <img id="img3" style="width: 150%;">
                    <div class="upload-msg"><i class="fas fa-image text-3xl text-gray-300"></i></div>
                </div>
                <div class="zoom-bar"><input type="range" min="0.5" max="3" step="0.1" value="1" oninput="updateZoom('img3', this.value)"></div>
                <div class="frame-label text-blue-500">STRETCHING</div>
            </div>

            <!-- SLEEPING -->
            <div class="polaroid transform -rotate-2">
                <input type="file" id="file4" class="hidden" accept="image/*" onchange="handleFileSelect(this, 'frame4', 'img4')">
                <div class="frame-container flex-grow" style="height: 100%;" id="frame4" onmousedown="startDrag(event, 'img4')" onclick="document.getElementById('file4').click()">
                    <img id="img4" style="width: 150%;">
                    <div class="upload-msg"><i class="fas fa-image text-3xl text-gray-300"></i></div>
                </div>
                <div class="zoom-bar"><input type="range" min="0.5" max="3" step="0.1" value="1" oninput="updateZoom('img4', this.value)"></div>
                <div class="frame-label text-purple-500">SLEEPING</div>
            </div>

        </div>

        <!-- FOOTER -->
        <div class="footer">
            <div>
                <div class="text-yellow-400 font-bold text-lg uppercase tracking-wide mb-1">Free to a good home</div>
                <div class="text-4xl comic-font">CALL ASSUNTA</div>
                <div class="text-sm text-gray-400 mt-1">Scan QR code for advertisement</div>
            </div>
            <div class="bg-white p-2 border-4 border-white rounded shadow-lg">
                <div id="qrcode"></div>
            </div>
        </div>

    </div>

    <script>
        // 1. QR CODE
        const adUrl = "https://en.petzlover.com/it/show-ad?adid=653823&ref=copy";
        new QRCode(document.getElementById("qrcode"), {
            text: adUrl, width: 80, height: 80, colorDark : "#000000", colorLight : "#ffffff", correctLevel : QRCode.CorrectLevel.H
        });

        // 2. IMAGE HANDLING
        const imgState = { 'img1': {x:0,y:0,s:1}, 'img2': {x:0,y:0,s:1}, 'img3': {x:0,y:0,s:1}, 'img4': {x:0,y:0,s:1} };

        function handleFileSelect(input, frameId, imgId) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    const img = document.getElementById(imgId);
                    img.src = e.target.result;
                    document.getElementById(frameId).querySelector('.upload-msg').style.opacity = '0';
                    setTimeout(() => document.getElementById(frameId).querySelector('.upload-msg').style.display = 'none', 300);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function updateZoom(imgId, val) {
            imgState[imgId].s = parseFloat(val); applyTransform(imgId);
        }

        let activeImgId = null, startX, startY, initialX, initialY;

        function startDrag(e, imgId) {
            if (!document.getElementById(imgId).src) return;
            e.preventDefault(); activeImgId = imgId;
            startX = e.clientX; startY = e.clientY;
            initialX = imgState[imgId].x; initialY = imgState[imgId].y;
            document.addEventListener('mousemove', drag); document.addEventListener('mouseup', stopDrag);
        }

        function drag(e) {
            if (!activeImgId) return;
            imgState[activeImgId].x = initialX + (e.clientX - startX);
            imgState[activeImgId].y = initialY + (e.clientY - startY);
            applyTransform(activeImgId);
        }

        function stopDrag() {
            activeImgId = null; document.removeEventListener('mousemove', drag); document.removeEventListener('mouseup', stopDrag);
        }

        function applyTransform(imgId) {
            const s = imgState[imgId];
            document.getElementById(imgId).style.transform = `translate(${s.x}px, ${s.y}px) scale(${s.s})`;
        }

        // 3. PDF GENERATION (OPTIMIZED FOR FIT)
        function downloadPDF() {
            const element = document.getElementById('flyer');
            const btn = document.querySelector('.btn-save');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = 'GENERATING...';
            
            const opt = {
                margin: 0,
                filename: 'Shonik_Comic_Flyer.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                btn.innerHTML = originalText;
            });
        }
    </script>
</body>
</html>